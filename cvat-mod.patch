From 1590724ba4784d6acf8e4c3a9bfbccfd9c7aa62d Mon Sep 17 00:00:00 2001
From: junjuew <junjuew@cs.cmu.edu>
Date: Mon, 26 Aug 2019 13:10:27 -0400
Subject: [PATCH] changed cvat engine prefix and js url redirection

---
 cvat/apps/engine/static/engine/js/annotationUI.js | 5 +++--
 cvat/apps/engine/urls.py                          | 6 +++++-
 2 files changed, 8 insertions(+), 3 deletions(-)

diff --git a/cvat/apps/engine/static/engine/js/annotationUI.js b/cvat/apps/engine/static/engine/js/annotationUI.js
index 7148e41..31f7503 100644
--- a/cvat/apps/engine/static/engine/js/annotationUI.js
+++ b/cvat/apps/engine/static/engine/js/annotationUI.js
@@ -538,8 +538,9 @@ function buildAnnotationUI(jobData, taskData, imageMetaData, annotationData, ann
         },
     };
 
-    // Remove external search parameters from url
-    window.history.replaceState(null, null, `${window.location.origin}/?id=${jobData.id}`);
+    // orig comment: Remove external search parameters from url
+    // junjuew: prevent url changes
+    // window.history.replaceState(null, null, `${window.location.origin}/?id=${jobData.id}`);
 
     window.cvat.config = new Config();
 
diff --git a/cvat/apps/engine/urls.py b/cvat/apps/engine/urls.py
index 534d72b..5ec6d3f 100644
--- a/cvat/apps/engine/urls.py
+++ b/cvat/apps/engine/urls.py
@@ -41,5 +41,9 @@ urlpatterns = [
 
     # entry point for API
     path('api/v1/auth/', include('cvat.apps.authentication.api_urls')),
-    path('api/v1/', include((router.urls, 'cvat'), namespace='v1'))
+
+    # junjuew: remove the cvat namespace as it creates problems for back_ref
+    # path('api/v1/', include((router.urls, 'cvat'), namespace='v1'))
+    # https://github.com/encode/django-rest-framework/issues/2760
+    path('api/v1/', include((router.urls)))
 ]
-- 
2.21.0

